# Workflow 
Our application uses Bluetooth to scan the area around the device for other app users and saves the data of these encounters. Once the user is covid positive, the health authorities can send him a code with which he can send us his data to cloud. A csv file is uploaded in our Database. Our Web gui can crosscheck the tuids of user contacts from csv and Database and tell us the details of user meeting. 
 
# How do we protect the user's privacy? 
 
* User can remove all collected data, including the phone number. 
* All data are saved locally on the user's device. Data are uploaded only with the user's consent after a healthcare authority's request. 
* The scanning can be turned off manually at any time. 
* The broadcasted Device ID is changed every hour, so a user cannot be tracked with it. (Only our backend has a knowledge of which Device ID's correspond to which phone number.) 
* The data are kept on backend for 6 hours, then deleted. 
 
 
# Technical Documentation 
 
## Terminology 
## FUID 
Firebase User ID, unique for each phone number, generated by Firebase Authentication after sign-in, 28 chars or more. 

## BUID 
Broadcasted user ID, unique for each registration, generated by Firebase function after registration, 10 bytes 

## TUID 
Transmitted user ID, actually transmitted over Bluetooth, each BUID gets about 100 TUIDs after registration, client picks a different one every hour or so, privacy measure to prevent tracking individual device/user, 10 bytes 

# Data format 
## Firebase Firestore 
Firestore is not readable or writable to user, only Functions. 

## Collection users 
•	Key: FUID 
Attributes: 
•	createdAt (timestamp of creation) 
•	registrationCount (number of BUIDs) 
## Collection registrations 
•	Key: BUID 
Attributes 
•	fuid 
•	platform (android) 
•	platformVersion (system version, e.g. 10.0.4) 
•	manufacturer (phone manufacturer, e.g. Samsung) 
•	model (phone model, e.g. Galaxy S7) 
•	locale (phone language, e.g. sa_ar) 
•	createdAt (timestamp of creation) 
•	pushRegistrationToken (push token from Firebase Cloud Messaging) 
## Collection tuids 
•	Key: TUID 
Attributes 
•	fuid 
•	buid 
•	createdAt (timestamp of creation) 

# Firebase Storage 
User can only upload data about his FUID, can't read other data. 

## Collection proximity 
•	Key: FUID/BUID 
•	Filename: $timestamp.csv 
## Metadata 
•	version (version of CSV model, current 4) 
## CSV columns 
•	tuid 
•	timestampStart (millis) 
•	timestampEnd (millis) 
•	avgRssi (average signal strength) 
•	medRssi (median signal strength) 

# Firebase Functions 
Main API for the app and other parts of the system, scales automatically, region: europe-west3 
Input and output are dictionaries. Functions doesn't return anything, unless specified here (but can throw error). 
## registerBuid 
Creates a new registration after authentication. 
### Input 
•	platform: string (android) 
•	platformVersion: string (system version, e.g. 10.0.4) 
•	manufacturer: string (phone manufacturer, e.g. Samsung) 
•	model: string (phone model, e.g. Galaxy S7) 
•	locale: string (phone language, e.g. sa_ar) 
•	pushRegistrationToken: string (push token from Firebase Cloud Messaging) 
### Output 
•	buid: string (created BUID) 
•	tuids: string[] (list of TUIDs) 
## deleteUploads 
Deletes all CSVs for one BUID. 
### Input 
	• 	buid: string 
## deleteBuid 
Deletes all data related to BUID. 
### Input 
	• 	buid: string 
## deleteUser 
Deletes all data related to FUID, including phone number in Firebase Authentication. 
## changePushToken 
Changes push token for BUID. 
### Input 
•	buid: string 
•	pushRegistrationToken: string isBuidActive 
Checks if FUID and BUID still exists Input: 
•	buid: string Output: 
•	boolean (active/inactive) 
# Firebase Remote Config 
Contains constants which we can changed later without updating the app. 
[Default values](https://github.com/covid19cz/erouska-android/blob/develop/app/src/main/res/xml/remote_config_defaults.xml) 
## Processes 
### Device Registration 
 
1.	App asks the user to enter the phone number. 
1.	App sends the phone number to Firebase Authentication. 
1.	Firebase sends back SMS with verification code 
1.	User verifies the device registration by entering the verification code from the SMS into the app (This is done automatically on most devices.) 
1.	After a successful authorization, the app finishes the registration by calling the registerBuids function. 

## Epidemiologists Interaction 
 
1.	An epidemiologist asks the user for the permission to use the data from app and asks to upload the data. 
1.	User gives permission by tapping "Upload data" in the app. CSVs can be uploaded only once per 15 minutes. The file is saved in Firebase Storage in the collection proximity. 
1.	Epidemiologist uses a web GUI to see a data for a particular phone number: 
    1.	Web app fetches a FUID related to the phone number. 
    1.	A blob is loaded for the particular FUID from the Firebase Storage. 
    1.	After the raw data is analysed, the TUIDs of people the person met are loaded from the blob, with: 
        1.	their respective phone numbers from the collection users 
        1.	a flag representing whether the person met was in close contact or not 
        1.	their respective device names 
    1.	Epidemiologist contacts the possibly newly infected. 
 
